// // Name: 		JPEG tester.¹// Version:		1.2// Author: 		Greg Simon// Date:		4/29/96, 11/4/96, 5/8/97, 6/20/98// Copyright:	(c) Copyright 1996-1998, Steve Weyer, Greg Simon//				All Rights Reserved Worldwide// // Description:	Example of using the new JPEG tools for Newton.constant kHelloSmallJPG := "\uFFD8FFE000104A46494600010201004800480000FFED01E850686F746F73686F7020332E30003842494D03E900000000007800030000004800480000000002D80228FFE1FFE202F902460347052803FC00020000004800480000000002D80228000100000064000000010003030300000001270F0001000100000000000000000000000060080019019000000000000000000000000000000000000000000000000000000000000000003842494D03ED000000000010004800000001000100480000000100013842494D03F300000000000800000000000000003842494D040A00000000000100003842494D271000000000000A000100000000000000023842494D03F5000000000048002F66660001006C66660006000000000001002F6666000100A1999A0006000000000001003200000001005A00000006000000000001003500000001002D000000060000000000013842494D03F80000000000700000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF03E800000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF03E800000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF03E800000000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF03E800003842494D0408000000000010000000010000024000000240000000003842494D04060000000000070004000000010100FFFE002746696C65207772697474656E2062792041646F62652050686F746F73686F70A820342E3000FFEE000E41646F626500640000000001FFDB0084000604040405040605050609060506090B080606080B0C0A0A0B0A0A0C100C0C0C0C0C0C100C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C010707070D0C0D18101018140E0E0E14140E0E0E0E14110C0C0C0C0C11110C0C0C0C0C0C110C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0CFFC00011080016004003011100021101031101FFDD00040008FFC401A20000000701010101010000000000000000040503020601000708090A0B0100020203010101010100000000000000010002030405060708090A0B1000020103030204020607030402060273010203110400052112314151061361227181143291A10715B14223C152D1E1331662F0247282F12543345392A2B26373C235442793A3B33617546474C3D2E2082683090A181984944546A4B456D355281AF2E3F3C4D4E4F465758595A5B5C5D5E5F566768696A6B6C6D6E6F637475767778797A7B7C7D7E7F738485868788898A8B8C8D8E8F82939495969798999A9B9C9D9E9F92A3A4A5A6A7A8A9AAABACADAEAFA110002020102030505040506040803036D0100021103042112314105511361220671819132A1B1F014C1D1E1234215526272F1332434438216925325A263B2C20773D235E2448317549308090A18192636451A2764745537F2A3B3C32829D3E3F38494A4B4C4D4E4F465758595A5B5C5D5E5F5465666768696A6B6C6D6E6F6475767778797A7B7C7D7E7F738485868788898A8B8C8D8E8F839495969798999A9B9C9D9E9F92A3A4A5A6A7A8A9AAABACADAEAFAFFDA000C03010002110311003F0093FE567E6179CF56FF009C8AF38F96B51D525B9D0B4E5BE36562C10247E95D451A50850DF0A332EED8AA33FE72C3CF9E6EF27F97B41B9F2D6A5269B3DD5DCB1DC3C41097458AA01E6ADDF157B05AEB36767E58B5D5B57BC8ADADD6D629AEEF2E1D638D79460B3333514549C5505E5CFCC7F21F996E9ECF41D7ECB52BB4059ADE0991A4E23AB04AF22BEE315795FE72F9F7CDFA27E75FE5FE85A56A725A693AB4B6EBA8DA2042B287BC11B722CA5B74F87E138AA1FCF7F983E72D3FFE7267CB1E55B3D52587CBF7B15B35D69EA1383973372A92A5F7E0BFB58ABDAFCC3E69F2DF972CC5EEBDA9DB6996AC78A4B752AC419BF957911C8FB2E2AA1E5AF3BF943CCF1CAFE5ED62D35410D3D616D2AC8C95E9C941E4B5F718ABFFD088E9DE52F37F9A3FE722FCF1A7F9575F7F2E6A31DC5FCD25F46D2216896E515A2AC4437C4CCADFEC715417FCE40FE5D7E64795346D26E3CDBE7097CCB6F73732476D048F3B889C254B8F55987C43E1DB15661FF393BAD5FDC5CFE5DF9519279F48B8B6B7BAB9B0B5244B7323B242117B19020658BFCB9715493CF1E5AD4DAFB43D5FF2DBF2BF5FF2BEB3A34FEABCC609592554A14A856725C30A37F3A332BF2C5598FE76DC4F73F9EDF94B717109B79E636324D035418DDEF14B21AF75278E2AB7F32BFF005B07C9FF00F186CFF5CF8AA0A4D12D3F33FF00E729F59D1FCD8ED3E8DE5F864FA9E98CEC88E907A68107120D1DE569E4E3F6BFD5C5507F9B5E5BD2BF28FF00393C9BACF91E26D3D35260B77A646EE6365599229128C4B709D24A70AF1E6BCD7157FFD13FFCA7D1744B6FF9C92F3A5FDB7986D6FB509D6FFD7D22282F1268395DC45B9C92C296EDC18703E94CFF006BE1F871546FFCE5DE8FA3EA7E5CF2FC7AA6BB6DA1471DE4AD1CD750DDCCB2131538A8B486E1811D7E30AB8AA87FCE41E87E40D47CBBE508352F318D0FCD70C687CB7771DB5D5C19C058C15296D1C9322B3FA6D13F1E4AFF00651BE3C5526D53CA3F99BFE26F2F4BF9A5E799C69B055AD2DB40B3D49E6B80A54BA4AD676B1AC4CFF0FA8D37EF38FD95FDAC553EFCE9D1F45BBFCEFF00CBABCBAD7ADB4EBBB696D8DAE9B3437724B734BC0C046F0C32429C8FC1FBE963FF0081C550FE7ED17449BFE728FCADA8CDE60B5B5D4628AD445A2BC378D3CA019A85658E17B65E55FF00764E9F67154B7F343CB7A06A3F9D4975F97DE6EFD0BF9A0BC52F74E16B79344EC21079B4D0C13429FB8E2265939C5C7EDF06E5C954168DE57B4B4FCE5D26F7F39FCE51EA3E6F4680685A547697696CF2172206F5CDBC36C1165DD523F87D6FEF1FF65957FFD90000";// --------------DefineGlobalConstant('kVersionNum, 		"1.0");DefineGlobalConstant('kVersionInt, 		"10");DefineGlobalConstant('kBetaVersion, 	"f");DefineGlobalConstant('kVersionString,	kVersionNum & kBetaVersion &		(if not kIgnoreNativeKeyword then $N) &		(if kDebugOn then $D) &		(if kProfileOn then $P) &		"-2");Print(kAppName && kVersionString);DefineGlobalConstant('kNewtsCapeSymbol, '|NewtsCape:NewtsCape|);constant kGIFextension := ".gif";DefineGlobalConstant('kEmptyGlobal, { // from Newt's Cape 1.6g	cache: [], historyPos: 0,				htmlApps: {}, helperApps: {},	imageExtensions: [kGIFextension],	protos: {},	}); DefineGlobalConstant('kJPEGextensions, [".jpg", ".jpeg"]);DefineGlobalConstant('kJPEGmediaType, "image/jpeg");// adjust params/result for current (>= 1.6h) Newt's Cape APIDefineGlobalConstant('kJPEGConvertFunc, func(data, thresh, bpp, anim)// swap thresh/bpp order? 4th arg: ignore anim, supply true for dithering argcall JPEG.Decompress with (data, bpp, thresh, true));DefineGlobalConstant('kJPEGframe, {	//extensions: kJPEGextensions,	// !!!f	addFile: func(type, href, content, options)	begin		local newtscape := GetRoot().(kNewtsCapeSymbol);		if options.cacheOnly		// !!!d		then newtscape:convertImage(type, href, content, options, kJPEGConvertFunc) // don't display		else begin			options.(EnsureInternal('convertImageFn)) := kJPEGConvertFunc; 		// !!!c			newtscape:addFile(type, href, content, options);	// convert,cache,display			end;	end,	});InstallScript := func(partFrame, removeFrame)//func(partFrame) if kDebugOn then AddDeferredCall(func() GetRoot().(kAppSymbol):Open(), nil);/*if GetRoot().(kNewtsCapeSymbol)		// Newt's Cape might not be installed yet?then GetRoot().(kNewtsCapeSymbol):installHelperApp(kJPEGmediaType, kAppSymbol, kJPEGframe)else*/ begin	local gData := GetGlobalVar(kNewtsCapeSymbol);	if not gData	then DefGlobalVar(kNewtsCapeSymbol, gData := EnsureInternal(kEmptyGlobal));	local imgExtensions := gData.imageExtensions;	// for distinguishing URLs for HTMLcache vs. ImageCache	ArrayMunger(imgExtensions, Length(imgExtensions), 0, EnsureInternal(kJPEGextensions), 0, nil); // !!!b	local helperApps	:= gData.helperApps;	local icontentType	:= EnsureInternal(Intern(kJPEGmediaType));	local helperFrame	:= helperApps.(icontentType);	if not helperFrame	then helperApps.(icontentType) := helperFrame := EnsureInternal({});	helperFrame.(EnsureInternal(kAppSymbol)) := kJPEGframe;	end;RemoveScript :=	func(removeFrame)	//nil;/*if GetRoot().(kNewtsCapeSymbol)		// Newt's Cape might not be installed yet?then GetRoot().(kNewtsCapeSymbol):installHelperApp(kJPEGmediaType, kAppSymbol, nil)else*/ begin	local gData := GetGlobalVar(kNewtsCapeSymbol), helperApps, helperFrame;	if gData and		(helperApps := gData.helperApps) and		helperFrame := helperApps.(Intern(kJPEGmediaType))	then RemoveSlot(helperFrame, kAppSymbol);	local imgExtensions, val;	if gData and imgExtensions := gData.imageExtensions	// !!!b	then foreach val in kJPEGextensions		 do if val := LSearch(imgExtensions,val,0,'|str=|,nil)			then ArrayRemoveCount(imgExtensions,val,1);	end;partData := {};